---
layout: post
title: textarea光标位置定位、插入、获取选择文字
description: textarea光标位置定位、获取选择文字、向光标位置插入指定字符串
keywords: textarea,document.selection,selectionStart,selectionEnd
categories: javascript
---

微博"@"功能相信每一个玩过微博的人都用过，当你输入"@"字符串时，在光标位置旁边就会生成一个提示框，你可以快速的选取你最近"@"过的人。

不过想要操作textarea可是一件麻烦事。不同浏览器下的接口不一致(其实就是IE不一致 _(:3」∠)_...)

先来看看IE下的接口 <span class="impo">document.selection</span>

{% highlight javascript linenos %}
function InsertString(ele, str){
    var r = null,newstart = 0,tb = ele.nodeType == 1 ? ele : docuemnt.body;
    tb.focus();
    if (document.all){
        r = document.selection.createRange();
        document.selection.empty();
        r.text = str;
        r.collapse();
        r.select();
    }else{
        newstart = tb.selectionStart+str.length;
        tb.value=tb.value.substr(0,tb.selectionStart)+str+tb.value.substring(tb.selectionEnd);
        tb.selectionStart = newstart;
        tb.selectionEnd = newstart;
    }
}
function GetSelection(ele){
    var sel = '',r = null,tb = ele.nodeType == 1 ? ele : docuemnt.body;
    if (document.all){
        r = document.selection.createRange();
        document.selection.empty();
        sel = r.text;
    }else{
        sel = tb.value.substring(tb.selectionStart, tb.selectionEnd);
    }
    return sel;
}
function ShowSelection(ele){
    var sel = GetSelection(ele);
    alert('选中的文本是：'+sel);
}
{% endhighlight %}
